<div class="tag-management-container">
  <div class="tag-header">
    <h1 class="heading-primary">Tags</h1>
    <p-button 
      label="Add Tag" 
      icon="pi pi-plus" 
      (click)="openNewTagDialog()"
      class="nav-btn-outline" />
  </div>

  <div class="tag-table-card modern-card">
    @if (loading) {
      <div style="text-align: center; padding: 3rem;">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: #667eea;"></i>
        <p style="margin-top: 1rem; color: #718096;">Loading tags...</p>
      </div>
    } @else if (tags.length === 0) {
      <div class="empty-message">
        <div class="empty-state">
          <i class="pi pi-tags empty-icon"></i>
          <h3 style="color: #718096; margin-bottom: 0.5rem;">No tags yet</h3>
          <p style="color: #a0aec0; margin-bottom: 2rem;">
            Create your first tag to organize your tasks.
          </p>
          <p-button 
            label="Create Tag" 
            icon="pi pi-plus" 
            (click)="openNewTagDialog()"
            class="nav-btn-outline" />
        </div>
      </div>
    } @else {
      <p-table 
        [value]="tags" 
        [paginator]="true" 
        [rows]="10"
        responsiveLayout="scroll"
        styleClass="modern-table">
        <ng-template pTemplate="header">
          <tr>
            <th>Color</th>
            <th>Name</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-tag>
          <tr>
            <td>
              <div 
                class="tag-color" 
                [style.background-color]="tag.color">
              </div>
            </td>
            <td>
              <span class="task-title">{{ tag.name }}</span>
            </td>
            <td>
              <span class="task-date">{{ tag.createdAt | date:'short' }}</span>
            </td>
            <td>
              <div class="task-actions">
                <p-button 
                  icon="pi pi-pencil" 
                  size="small"
                  (click)="openEditTagDialog(tag)"
                  class="action-btn edit-btn" />
                <p-button 
                  icon="pi pi-trash" 
                  size="small"
                  (click)="confirmDelete(tag)"
                  severity="danger"
                  class="action-btn delete-btn" />
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="empty-message">
              <div class="empty-state">
                <i class="pi pi-tags empty-icon"></i>
                <p>No tags found. Start by creating your first tag!</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </div>
</div>

<!-- Form Page Layout -->
@if (isFormPage) {
  <div class="tag-form-page">
    @if (loading) {
      <div class="modern-card">
        <div style="text-align: center; padding: 3rem;">
          <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: var(--primary-color);"></i>
          <p style="margin-top: 1rem; color: var(--gray-600);">Loading...</p>
        </div>
      </div>
    } @else {
    <div class="modern-card">
      <div class="form-header">
        <div class="form-icon">
          <i class="pi" [ngClass]="isEditMode ? 'pi-pencil' : 'pi-plus'"></i>
        </div>
        <h1>{{ isEditMode ? 'Edit Tag' : 'Create New Tag' }}</h1>
        <p>{{ isEditMode ? 'Update tag details' : 'Add a new tag to organize your tasks' }}</p>
      </div>

      <form [formGroup]="tagForm" (ngSubmit)="onSubmit()" class="tag-form">
        <div class="form-group">
          <label for="tagName" class="form-label">Tag Name *</label>
          <input 
            pInputText
            type="text" 
            id="tagName" 
            formControlName="name" 
            class="form-input"
            placeholder="Enter tag name..."
            [class.error]="tagForm.get('name')?.invalid && tagForm.get('name')?.touched">
          @if (tagForm.get('name')?.invalid && tagForm.get('name')?.touched) {
            <small class="error-message">
              Tag name is required
            </small>
          }
        </div>

        <div class="form-group">
          <label for="tagColor" class="form-label">Color *</label>
          <p-colorPicker 
            formControlName="color"
            class="form-input"
            [style]="{'width': '100%'}"
            [inline]="false">
          </p-colorPicker>
          @if (tagForm.get('color')?.invalid && tagForm.get('color')?.touched) {
            <small class="error-message">
              Please select a color
            </small>
          }
        </div>

        <div class="form-group">
          <label class="form-label">Preview:</label>
          <div class="preview-section">
            <p-tag 
              [value]="tagForm.get('name')?.value || 'Tag Name'"
              [style]="{'background-color': (tagForm.get('color')?.value || '#667eea') + '20', 'color': tagForm.get('color')?.value || '#667eea', 'border': '1px solid ' + (tagForm.get('color')?.value || '#667eea')}"
              class="preview-tag">
            </p-tag>
          </div>
        </div>

        <div class="form-actions">
          <p-button 
            label="Cancel" 
            icon="pi pi-times" 
            [outlined]="true"
            type="button"
            (click)="onCancel()"
            class="cancel-btn" />
          <p-button 
            [label]="isEditMode ? 'Update Tag' : 'Create Tag'" 
            [icon]="isEditMode ? 'pi pi-check' : 'pi pi-plus'" 
            type="submit"
            [disabled]="tagForm.invalid || loading"
            [loading]="loading"
            class="submit-btn" />
        </div>
      </form>
    </div>
  }
  </div>
}

<!-- Tag Dialog (for list page) -->
<p-dialog 
  [header]="isEditMode ? 'Edit Tag' : 'New Tag'" 
  [(visible)]="showTagDialog" 
  [modal]="true" 
  [style]="{width: '450px'}"
  [draggable]="false"
  [resizable]="false"
  (onHide)="onDialogHide()">
  
  <div class="dialog-header">
    <div class="dialog-icon">
      <i class="pi" [ngClass]="isEditMode ? 'pi-pencil' : 'pi-plus'"></i>
    </div>
    <h3>{{ isEditMode ? 'Edit Tag' : 'Create New Tag' }}</h3>
    <p>{{ isEditMode ? 'Update tag details' : 'Add a new tag to organize your tasks' }}</p>
  </div>

  <form [formGroup]="tagForm" (ngSubmit)="onSubmit()" class="tag-form">
    <div class="form-group">
      <label for="tagName" class="form-label">Tag Name *</label>
      <input 
        pInputText
        type="text" 
        id="tagName" 
        formControlName="name" 
        class="form-input"
        placeholder="Enter tag name..."
        [class.error]="tagForm.get('name')?.invalid && tagForm.get('name')?.touched">
      @if (tagForm.get('name')?.invalid && tagForm.get('name')?.touched) {
        <small class="error-message">
          Tag name is required
        </small>
      }
    </div>

    <div class="form-group">
      <label for="tagColor" class="form-label">Color *</label>
      <p-colorPicker 
        formControlName="color"
        class="form-input"
        [style]="{'width': '100%'}"
        [inline]="false">
      </p-colorPicker>
      @if (tagForm.get('color')?.invalid && tagForm.get('color')?.touched) {
        <small class="error-message">
          Please select a color
        </small>
      }
    </div>

    <div class="form-group">
      <label class="form-label">Preview:</label>
      <div class="preview-section">
        <p-tag 
          [value]="tagForm.get('name')?.value || 'Tag Name'"
          [style]="{'background-color': (tagForm.get('color')?.value || '#667eea') + '20', 'color': tagForm.get('color')?.value || '#667eea', 'border': '1px solid ' + (tagForm.get('color')?.value || '#667eea')}"
          class="preview-tag">
        </p-tag>
      </div>
    </div>

    <div class="form-actions">
      <p-button 
        label="Cancel" 
        icon="pi pi-times" 
        [outlined]="true"
        type="button"
        (click)="onCancel()"
        class="cancel-btn" />
      <p-button 
        [label]="isEditMode ? 'Update Tag' : 'Create Tag'" 
        [icon]="isEditMode ? 'pi pi-check' : 'pi pi-plus'" 
        type="submit"
        [disabled]="tagForm.invalid || loading"
        [loading]="loading"
        class="submit-btn" />
    </div>
  </form>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>